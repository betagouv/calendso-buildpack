#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir>

# Debug, echo every command
if [[ -n "$BUILDPACK_DEBUG" ]]; then
  set -x
fi

# Fail immediately on non-zero exit code.
set -e
# Fail immediately on non-zero exit code within a pipeline.
set -o pipefail
# Fail on undeclared variables.
set -u

echo "=====> Start Calendso"

BUILD_DIR=$1
CACHE_DIR=$2
ENV_DIR=$3
basedir="$( cd -P "$( dirname "$0" )" && pwd )"
BP_DIR=`cd $(dirname $0); cd ..; pwd`
TMP_PATH="$BUILD_DIR/tmp"

echo "## start here $basedir $BP_DIR $BUILD_DIR"
cp $BP_DIR/.buildpacks $BUILD_DIR/.buildpacks

# Use architecture of multi-buildpack to compose behavior.
# https://github.com/Scalingo/multi-buildpack

url=https://github.com/Scalingo/multi-buildpack

echo "=====> Downloading Buildpack "

# install addons
cd $BUILD_DIR
$BP_DIR/bin/install_calendso.sh

for d in errbackends errstorage plugins; do
  [ -d "$d" ] || mkdir $BUILD_DIR/$d
done

echo "   scalingo-calendso-buildpack"
